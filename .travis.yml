language: node_js
node_js:
  - "8"

cache:
  directories:
    - "node_modules"

install:
  - yarn

script:
  - node src/tasks/fetchPatrons.js
  - node src/tasks/fetchVideos.js $ytkey
  - yarn unit
  - yarn build

deploy:
  provider: pages
  skip-cleanup: true
  github-token: $githubkey
  local-dir: dist
  fqdn: reaction-role.com
  target-branch: master
  on:
    branch: src

after_success:
  - wget https://raw.githubusercontent.com/k3rn31p4nic/travis-ci-discord-webhook/master/send.sh
  - chmod +x send.sh
  - ./send.sh success $webhook_url
after_failure:
  - wget https://raw.githubusercontent.com/k3rn31p4nic/travis-ci-discord-webhook/master/send.sh
  - chmod +x send.sh
  - ./send.sh failure $webhook_url